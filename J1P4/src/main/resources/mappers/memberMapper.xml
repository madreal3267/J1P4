<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.itwillbs.mapper.MemberMapper">
  	 
  	  <!-- 회원가입 -->
  	 <insert id="join">
  	 	insert into user (name,user_id,user_email,user_pw)
  	 	values(#{name},#{user_id},#{user_email},#{user_pw})
  	 </insert>
  	 
  	 <!-- 로그인 -->
  	 <select id="memberLogin" resultType="com.itwillbs.domain.MemberVO">
  	 	select * from user
  	 	where user_id=#{user_id} and user_pw=#{user_pw}
  	 </select>
  	 
  	 <!--이메일로 아이디 찾기 -->
  	 <select id="findId" resultType="com.itwillbs.domain.MemberVO">
		select * from user where user_email=#{user_email}
	</select>

	<!--입력한 이메일 수를 카운트해서 0이 나오면 팝업창에 "정확한 이메일 입력바람" -->
	<select id="findIdCheck" resultType="int">
		select count(*) from user where user_email=#{user_email}
	</select>
	
	
	<!-- 난수생성 후 저장 -->
	<update id="mailkey">
		update user
		set mail_key=#{mail_key}
		where user_id=#{user_id} 
	</update>
	
	<!-- 난수비교 -->
	<!-- 저장된 이메일과 난수를 가진 유저의 비밀번호를 바꾸는 쿼리  -->
	<update id="mailkey2">
	update user
	set user_pw=#{user_pw}
	where user_id=(select user_id from user where user_email=#{user_email} and mail_key=#{mail_key}) 
	</update>
	
	
	<!-- 아이디 존재하는지 비교하기 -->
    <select id="findUserById" parameterType="String" resultType="com.itwillbs.domain.MemberVO">
        SELECT * FROM user WHERE user_id = #{user_id}
    </select>
	
	<!-- 난수가 존재하는지 비교하기 -->
    <select id="findUserByMailKey" parameterType="String" resultType="com.itwillbs.domain.MemberVO">
        SELECT * FROM user WHERE mail_key = #{mail_key}
    </select>
	
	
	
  	 
  
  </mapper>